openapi: 3.0.2
info:
  version: 1.0.0
  title: API Soulsdle - Jeu de devinettes sur les boss FromSoftware
  description: API REST pour un jeu de type Wordle avec les boss des jeux FromSoftware (Bloodborne, Sekiro, Dark Souls III)
  contact:
    name: "Cyrian Torrejon | Sinfix"
    email: cyrian.torrejon@etu.univ-grenoble-alpes.fr
servers:
  - url: http://localhost:3000
    description: Serveur de d√©veloppement local
paths:
  /:
    get:
      tags:
        - Info
      summary: Informations g√©n√©rales sur l'API
      responses:
        "200":
          description: Informations sur l'API et le jeu
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiInfo"

  /auth/register:
    post:
      tags:
        - Authentification
      summary: Inscription d'un nouveau joueur
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                pseudo:
                  type: string
                  example: "SoulsHunter"
                email:
                  type: string
                  format: email
                  example: "soulshunter@example.com"
                password:
                  type: string
                  format: password
                  minLength: 6
                  example: "password123"
              required:
                - pseudo
                - email
                - password
      responses:
        "201":
          description: Joueur cr√©√© avec succ√®s
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResponse"
        "400":
          description: Donn√©es invalides (pseudo ou email d√©j√† utilis√©)

  /auth/login:
    post:
      tags:
        - Authentification
      summary: Connexion d'un joueur
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                  example: "soulshunter@example.com"
                password:
                  type: string
                  format: password
                  example: "password123"
              required:
                - email
                - password
      responses:
        "200":
          description: Connexion r√©ussie
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResponse"
        "401":
          description: Email ou mot de passe incorrect

  /auth/me:
    get:
      tags:
        - Authentification
      summary: R√©cup√©rer le profil du joueur connect√©
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Profil du joueur
          content:
            application/json:
              schema:
                type: object
                properties:
                  joueur:
                    $ref: "#/components/schemas/JoueurProfile"
        "401":
          description: Non authentifi√©

  /auth/verify:
    post:
      tags:
        - Authentification
      summary: V√©rifier la validit√© d'un token JWT
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Token valide
          content:
            application/json:
              schema:
                type: object
                properties:
                  valid:
                    type: boolean
                    example: true
                  joueur:
                    $ref: "#/components/schemas/JoueurProfile"
        "401":
          description: Token invalide

  /boss:
    get:
      tags:
        - Boss
      summary: Liste tous les boss
      parameters:
        - $ref: "#/components/parameters/pageParam"
        - $ref: "#/components/parameters/limitParam"
        - name: jeu
          in: query
          description: Filtrer par jeu
          required: false
          schema:
            type: string
            enum:
              [
                Bloodborne,
                Sekiro,
                "Dark Souls",
                "Dark Souls II",
                "Dark Souls III",
                "Elden Ring",
              ]
        - name: optionnel
          in: query
          description: Filtrer par boss optionnels ou obligatoires
          required: false
          schema:
            type: string
            enum: [Optionnel, Obligatoire]
        - name: dlc
          in: query
          description: Filtrer par boss de DLC
          required: false
          schema:
            type: string
            enum: [DLC, Base]
      responses:
        "200":
          description: Liste des boss (noms uniquement pour ne pas spoiler)
          content:
            application/json:
              schema:
                type: object
                properties:
                  boss:
                    type: array
                    items:
                      type: string
                  pagination:
                    $ref: "#/components/schemas/Pagination"
    post:
      tags:
        - Boss
      summary: Ajoute un nouveau boss
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Boss"
      responses:
        "201":
          description: Boss cr√©√© avec succ√®s
        "400":
          description: Donn√©es invalides

  /boss/{nom}:
    get:
      tags:
        - Boss
      summary: D√©tails d'un boss sp√©cifique
      parameters:
        - name: nom
          in: path
          description: Nom du boss
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Informations d√©taill√©es du boss
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Boss"
        "404":
          description: Boss non trouv√©
    put:
      tags:
        - Boss
      summary: Met √† jour un boss
      parameters:
        - name: nom
          in: path
          description: Nom du boss
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Boss"
      responses:
        "200":
          description: Boss mis √† jour
        "404":
          description: Boss non trouv√©
    delete:
      tags:
        - Boss
      summary: Supprime un boss
      parameters:
        - name: nom
          in: path
          description: Nom du boss
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Boss supprim√©
        "404":
          description: Boss non trouv√©

  /jeu:
    get:
      tags:
        - Jeu
      summary: Commence une nouvelle partie
      responses:
        "200":
          description: Informations de la partie
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Partie"

  /jeu/guess:
    post:
      tags:
        - Jeu
      summary: Soumet une proposition
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                proposition:
                  type: string
                  description: Nom du boss propos√©
              required:
                - proposition
      responses:
        "200":
          description: R√©sultat de la proposition
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ResultatProposition"
        "400":
          description: Proposition invalide

  /souls:
    get:
      tags:
        - Souls
      summary: Liste tous les Souls
      parameters:
        - $ref: "#/components/parameters/pageParam"
        - $ref: "#/components/parameters/limitParam"
      responses:
        "200":
          description: Liste des Souls
          content:
            application/json:
              schema:
                type: object
                properties:
                  souls:
                    type: array
                    items:
                      $ref: "#/components/schemas/Souls"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
    post:
      tags:
        - Souls
      summary: Ajoute un nouveau Souls
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Souls"
      responses:
        "201":
          description: Souls cr√©√© avec succ√®s

  /souls/{id}:
    get:
      tags:
        - Souls
      summary: D√©tails d'un Souls sp√©cifique
      parameters:
        - name: id
          in: path
          description: ID du Souls
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Informations d√©taill√©es du jeu
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Souls"
        "404":
          description: Jeu non trouv√©
    put:
      tags:
        - Souls
      summary: Met √† jour un Souls
      parameters:
        - name: id
          in: path
          description: ID du Souls
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Souls"
      responses:
        "200":
          description: Souls mis √† jour
        "404":
          description: Souls non trouv√©
    delete:
      tags:
        - Souls
      summary: Supprime un Souls
      parameters:
        - name: id
          in: path
          description: ID du Souls
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Souls supprim√©
        "404":
          description: Souls non trouv√©

  /joueurs:
    get:
      tags:
        - Joueurs
      summary: Liste tous les joueurs
      parameters:
        - $ref: "#/components/parameters/pageParam"
        - $ref: "#/components/parameters/limitParam"
      responses:
        "200":
          description: Liste des joueurs
          content:
            application/json:
              schema:
                type: object
                properties:
                  joueurs:
                    type: array
                    items:
                      $ref: "#/components/schemas/Joueur"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
    post:
      tags:
        - Joueurs
      summary: Cr√©e un nouveau joueur
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Joueur"
      responses:
        "201":
          description: Joueur cr√©√© avec succ√®s

  /joueurs/{id}:
    get:
      tags:
        - Joueurs
      summary: D√©tails d'un joueur sp√©cifique
      parameters:
        - name: id
          in: path
          description: ID du joueur
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Informations d√©taill√©es du joueur
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Joueur"
        "404":
          description: Joueur non trouv√©
    put:
      tags:
        - Joueurs
      summary: Met √† jour un joueur
      parameters:
        - name: id
          in: path
          description: ID du joueur
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Joueur"
      responses:
        "200":
          description: Joueur mis √† jour
        "404":
          description: Joueur non trouv√©
    delete:
      tags:
        - Joueurs
      summary: Supprime un joueur
      parameters:
        - name: id
          in: path
          description: ID du joueur
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Joueur supprim√©
        "404":
          description: Joueur non trouv√©

  /parties:
    get:
      tags:
        - Parties
      summary: Liste toutes les parties
      parameters:
        - $ref: "#/components/parameters/pageParam"
        - $ref: "#/components/parameters/limitParam"
        - name: joueurId
          in: query
          description: Filtrer par joueur
          required: false
          schema:
            type: string
        - name: sort
          in: query
          description: Ordre de tri par date (desc = plus r√©cent d'abord, asc = plus ancien d'abord)
          required: false
          schema:
            type: string
            enum: [asc, desc]
            default: desc
      responses:
        "200":
          description: Liste des parties
          content:
            application/json:
              schema:
                type: object
                properties:
                  parties:
                    type: array
                    items:
                      $ref: "#/components/schemas/Partie"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
    post:
      tags:
        - Parties
      summary: Cr√©e une nouvelle partie
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Partie"
      responses:
        "201":
          description: Partie cr√©√©e avec succ√®s

  /parties/{id}:
    get:
      tags:
        - Parties
      summary: D√©tails d'une partie sp√©cifique
      parameters:
        - name: id
          in: path
          description: ID de la partie
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Informations d√©taill√©es de la partie
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Partie"
        "404":
          description: Partie non trouv√©e
    put:
      tags:
        - Parties
      summary: Met √† jour une partie
      parameters:
        - name: id
          in: path
          description: ID de la partie
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Partie"
      responses:
        "200":
          description: Partie mise √† jour
        "404":
          description: Partie non trouv√©e
    delete:
      tags:
        - Parties
      summary: Supprime une partie
      parameters:
        - name: id
          in: path
          description: ID de la partie
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Partie supprim√©e
        "404":
          description: Partie non trouv√©e

  /achievements:
    get:
      tags:
        - Achievements
      summary: Liste tous les achievements avec statistiques globales
      responses:
        "200":
          description: Liste des achievements
          content:
            application/json:
              schema:
                type: object
                properties:
                  achievements:
                    type: array
                    items:
                      allOf:
                        - $ref: "#/components/schemas/Achievement"
                        - type: object
                          properties:
                            totalDeblocages:
                              type: integer
                              description: Nombre de joueurs ayant d√©bloqu√© cet achievement
                            pourcentage:
                              type: number
                              format: float
                              description: Pourcentage de joueurs ayant d√©bloqu√©

  /achievements/me:
    get:
      tags:
        - Achievements
      summary: Achievements du joueur connect√©
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Achievements du joueur
          content:
            application/json:
              schema:
                type: object
                properties:
                  unlocked:
                    type: array
                    items:
                      allOf:
                        - $ref: "#/components/schemas/Achievement"
                        - type: object
                          properties:
                            dateDeblocage:
                              type: string
                              format: date-time
                  inProgress:
                    type: array
                    items:
                      allOf:
                        - $ref: "#/components/schemas/Achievement"
                        - type: object
                          properties:
                            progression:
                              type: number
                              format: float
                              description: Progression entre 0 et 1
                            progressionActuelle:
                              type: integer
                            progressionRequise:
                              type: integer
                  totalUnlocked:
                    type: integer
                  totalAchievements:
                    type: integer
        "401":
          description: Non authentifi√©

  /achievements/{id}:
    get:
      tags:
        - Achievements
      summary: D√©tails d'un achievement avec statistiques
      parameters:
        - name: id
          in: path
          description: ID de l'achievement
          required: true
          schema:
            type: string
      responses:
        "200":
          description: D√©tails de l'achievement
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/Achievement"
                  - type: object
                    properties:
                      totalDeblocages:
                        type: integer
                      pourcentage:
                        type: number
                        format: float
        "404":
          description: Achievement non trouv√©

  /achievements/{id}/check:
    post:
      tags:
        - Achievements
      summary: V√©rifier manuellement un achievement pour le joueur connect√©
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          description: ID de l'achievement
          required: true
          schema:
            type: string
      responses:
        "200":
          description: R√©sultat de la v√©rification
          content:
            application/json:
              schema:
                type: object
                properties:
                  unlocked:
                    type: boolean
                  achievement:
                    $ref: "#/components/schemas/Achievement"
        "401":
          description: Non authentifi√©
        "404":
          description: Achievement non trouv√©

  /achievements/check-all:
    post:
      tags:
        - Achievements
      summary: V√©rifier tous les achievements pour le joueur connect√©
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Liste des nouveaux achievements d√©bloqu√©s
          content:
            application/json:
              schema:
                type: object
                properties:
                  newAchievements:
                    type: array
                    items:
                      $ref: "#/components/schemas/Achievement"
                  count:
                    type: integer
        "401":
          description: Non authentifi√©

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: "Token JWT obtenu lors de la connexion ou l'inscription. Format: Authorization: Bearer <token>"

  schemas:
    ApiInfo:
      type: object
      properties:
        nom:
          type: string
          example: "Soulsdle API"
        description:
          type: string
          example: "API pour le jeu de devinettes Soulsdle"
        version:
          type: string
          example: "1.0.0"
        totalBoss:
          type: integer
          example: 150

    Boss:
      type: object
      properties:
        nom:
          type: string
          description: Nom du boss (identifiant unique)
          example: "P√®re Gascoigne"
        jeu:
          type: string
          enum: [Bloodborne, Sekiro, "Dark Souls III", "Dark Souls"]
          example: "Bloodborne"
        genre:
          type: string
          enum: [Homme, Femme, Inconnu]
          example: "Homme"
        espece:
          type: array
          items:
            type: string
          example: ["Humain", "B√™te"]
        phases:
          type: integer
          minimum: 1
          maximum: 3
          example: 2
        nombre:
          type: integer
          description: Nombre d'entit√©s dans le combat
          example: 1
        cutscene:
          type: string
          enum: [Oui, Non]
          example: "Oui"
        optionnel:
          type: string
          enum: [Optionnel, Obligatoire]
          example: "Obligatoire"
        dlc:
          type: string
          enum: [DLC, Base]
          example: "Base"
      required:
        - nom
        - jeu
        - genre
        - espece
        - phases
        - nombre
        - cutscene
        - optionnel
        - dlc

    Partie:
      type: object
      properties:
        id:
          type: string
          description: Identifiant unique de la partie
          example: "partie-001"
        dateDebut:
          type: string
          format: date-time
          description: Date et heure de d√©but de la partie
          example: "2024-01-15T10:30:00Z"
        dateFin:
          type: string
          format: date-time
          description: Date et heure de fin de la partie
          example: "2024-01-15T10:45:00Z"
        bossSecret:
          type: string
          description: Nom du boss √† deviner
          example: "P√®re Gascoigne"
        tentatives:
          type: integer
          description: Nombre de tentatives utilis√©es
          example: 4
        joueurId:
          type: string
          description: ID du joueur
          example: "joueur-001"
      required:
        - id
        - dateDebut
        - bossSecret
        - joueurId

    ResultatProposition:
      type: object
      properties:
        proposition:
          type: string
          description: Nom du boss propos√©
        correct:
          type: boolean
          description: True si c'est la bonne r√©ponse
        indices:
          type: object
          properties:
            jeu:
              type: string
              enum: [correct, incorrect]
            genre:
              type: string
              enum: [correct, incorrect]
            espece:
              type: string
              enum: [correct, partial, incorrect]
            phases:
              type: string
              enum: [correct, incorrect]
            nombre:
              type: string
              enum: [correct, incorrect]
            cutscene:
              type: string
              enum: [correct, incorrect]
            optionnel:
              type: string
              enum: [correct, incorrect]
            dlc:
              type: string
              enum: [correct, incorrect]

    Souls:
      type: object
      properties:
        id:
          type: string
          description: Identifiant unique du jeu
          example: "bloodborne"
        nom:
          type: string
          description: Nom complet du jeu
          example: "Bloodborne"
        annee:
          type: integer
          description: Ann√©e de sortie
          example: 2015
        developpeur:
          type: string
          example: "FromSoftware"
        genre:
          type: string
          example: "Action RPG"
        plateforme:
          type: array
          items:
            type: string
          example: ["PS4", "Xbox One", "PC"]
      required:
        - id
        - nom
        - annee
        - developpeur
        - genre
        - plateforme

    Joueur:
      type: object
      properties:
        id:
          type: string
          description: Identifiant unique du joueur (g√©n√©r√© automatiquement)
          example: "65a1b2c3d4e5f6g7h8i9j0k1"
        pseudo:
          type: string
          description: Pseudonyme du joueur (unique)
          example: "SoulsHunter"
        email:
          type: string
          format: email
          description: Adresse email du joueur (unique)
          example: "soulshunter@example.com"
        password:
          type: string
          format: password
          description: Mot de passe hash√© (non renvoy√© dans les r√©ponses)
          minLength: 6
        partiesGagnees:
          type: integer
          description: Nombre de parties gagn√©es
          default: 0
          example: 12
        streakActuelle:
          type: integer
          description: S√©rie actuelle de victoires cons√©cutives
          default: 0
          example: 5
        meilleureStreak:
          type: integer
          description: Meilleure s√©rie de victoires cons√©cutives
          default: 0
          example: 12
        createdAt:
          type: string
          format: date-time
          description: Date de cr√©ation du compte
        updatedAt:
          type: string
          format: date-time
          description: Date de derni√®re mise √† jour
      required:
        - pseudo
        - email
        - password

    JoueurProfile:
      type: object
      description: Profil public du joueur (sans mot de passe)
      properties:
        id:
          type: string
          example: "65a1b2c3d4e5f6g7h8i9j0k1"
        pseudo:
          type: string
          example: "SoulsHunter"
        email:
          type: string
          format: email
          example: "soulshunter@example.com"
        partiesGagnees:
          type: integer
          example: 12
        streakActuelle:
          type: integer
          example: 5
        meilleureStreak:
          type: integer
          example: 12
      required:
        - id
        - pseudo
        - email
        - partiesGagnees
        - streakActuelle
        - meilleureStreak

    AuthResponse:
      type: object
      properties:
        message:
          type: string
          example: "Connexion r√©ussie"
        token:
          type: string
          description: Token JWT pour l'authentification
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        joueur:
          $ref: "#/components/schemas/JoueurProfile"
      required:
        - message
        - token
        - joueur

    Achievement:
      type: object
      description: Achievement d√©blocable par les joueurs
      properties:
        id:
          type: string
          description: Identifiant unique de l'achievement
          example: "achievement-first-blood"
        nom:
          type: string
          description: Nom de l'achievement
          example: "Premier sang"
        description:
          type: string
          description: Description de comment d√©bloquer l'achievement
          example: "Gagner votre premi√®re partie"
        icone:
          type: string
          description: Emoji repr√©sentant l'achievement
          example: "ü©∏"
        categorie:
          type: string
          enum: [Progression, Comp√©tence, Collection, Sp√©cial]
          description: Cat√©gorie de l'achievement
          example: "Progression"
        rarete:
          type: string
          enum: [Commun, Rare, √âpique, L√©gendaire]
          description: Raret√© de l'achievement
          example: "Commun"
        condition:
          type: object
          description: Conditions de d√©blocage
          properties:
            type:
              type: string
              enum:
                - parties_gagnees
                - streak
                - meilleure_streak
                - tentatives_parfaites
                - victoire_jeu
                - total_parties
              description: Type de condition
              example: "parties_gagnees"
            valeur:
              type: integer
              description: Valeur √† atteindre
              example: 1
            jeu:
              type: string
              description: Jeu sp√©cifique (pour victoire_jeu)
              example: "Bloodborne"
            tentativesMax:
              type: integer
              description: Nombre maximum de tentatives (pour tentatives_parfaites)
              example: 3
          required:
            - type
            - valeur
        ordre:
          type: integer
          description: Ordre d'affichage
          example: 1
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required:
        - id
        - nom
        - description
        - icone
        - categorie
        - rarete
        - condition

    Pagination:
      type: object
      properties:
        page:
          type: integer
        limit:
          type: integer
        total:
          type: integer
        totalPages:
          type: integer

  parameters:
    pageParam:
      name: page
      in: query
      description: Num√©ro de page (commence √† 1)
      required: false
      schema:
        minimum: 1
        type: integer
        format: int32
        default: 1

    limitParam:
      name: limit
      in: query
      description: Nombre maximum d'√©l√©ments par page
      required: false
      schema:
        maximum: 100
        minimum: 1
        type: integer
        format: int32
        default: 20
