openapi: 3.0.2
info:
  version: 1.0.0
  title: API Soulsdle - Jeu de devinettes sur les boss FromSoftware
  description: API REST pour un jeu de type Wordle avec les boss des jeux FromSoftware (Bloodborne, Sekiro, Dark Souls III)
  contact:
    name: "Cyrian Torrejon | Sinfix"
    email: cyrian.torrejon@etu.univ-grenoble-alpes.fr
servers:
  - url: http://localhost:3000
    description: Serveur de développement local
paths:
  /:
    get:
      tags:
        - Info
      summary: Informations générales sur l'API
      responses:
        "200":
          description: Informations sur l'API et le jeu
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiInfo"

  /auth/register:
    post:
      tags:
        - Authentification
      summary: Inscription d'un nouveau joueur
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                pseudo:
                  type: string
                  example: "SoulsHunter"
                email:
                  type: string
                  format: email
                  example: "soulshunter@example.com"
                password:
                  type: string
                  format: password
                  minLength: 6
                  example: "password123"
              required:
                - pseudo
                - email
                - password
      responses:
        "201":
          description: Joueur créé avec succès
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResponse"
        "400":
          description: Données invalides (pseudo ou email déjà utilisé)

  /auth/login:
    post:
      tags:
        - Authentification
      summary: Connexion d'un joueur
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                  example: "soulshunter@example.com"
                password:
                  type: string
                  format: password
                  example: "password123"
              required:
                - email
                - password
      responses:
        "200":
          description: Connexion réussie
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResponse"
        "401":
          description: Email ou mot de passe incorrect

  /auth/me:
    get:
      tags:
        - Authentification
      summary: Récupérer le profil du joueur connecté
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Profil du joueur
          content:
            application/json:
              schema:
                type: object
                properties:
                  joueur:
                    $ref: "#/components/schemas/JoueurProfile"
        "401":
          description: Non authentifié

  /auth/verify:
    post:
      tags:
        - Authentification
      summary: Vérifier la validité d'un token JWT
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Token valide
          content:
            application/json:
              schema:
                type: object
                properties:
                  valid:
                    type: boolean
                    example: true
                  joueur:
                    $ref: "#/components/schemas/JoueurProfile"
        "401":
          description: Token invalide

  /boss:
    get:
      tags:
        - Boss
      summary: Liste tous les boss
      parameters:
        - $ref: "#/components/parameters/pageParam"
        - $ref: "#/components/parameters/limitParam"
        - name: jeu
          in: query
          description: Filtrer par jeu
          required: false
          schema:
            type: string
            enum:
              [
                Bloodborne,
                Sekiro,
                "Dark Souls",
                "Dark Souls II",
                "Dark Souls III",
                "Elden Ring",
              ]
        - name: optionnel
          in: query
          description: Filtrer par boss optionnels ou obligatoires
          required: false
          schema:
            type: string
            enum: [Optionnel, Obligatoire]
        - name: dlc
          in: query
          description: Filtrer par boss de DLC
          required: false
          schema:
            type: string
            enum: [DLC, Base]
      responses:
        "200":
          description: Liste des boss (noms uniquement pour ne pas spoiler)
          content:
            application/json:
              schema:
                type: object
                properties:
                  boss:
                    type: array
                    items:
                      type: string
                  pagination:
                    $ref: "#/components/schemas/Pagination"
    post:
      tags:
        - Boss
      summary: Ajoute un nouveau boss
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Boss"
      responses:
        "201":
          description: Boss créé avec succès
        "400":
          description: Données invalides

  /boss/{nom}:
    get:
      tags:
        - Boss
      summary: Détails d'un boss spécifique
      parameters:
        - name: nom
          in: path
          description: Nom du boss
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Informations détaillées du boss
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Boss"
        "404":
          description: Boss non trouvé
    put:
      tags:
        - Boss
      summary: Met à jour un boss
      parameters:
        - name: nom
          in: path
          description: Nom du boss
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Boss"
      responses:
        "200":
          description: Boss mis à jour
        "404":
          description: Boss non trouvé
    delete:
      tags:
        - Boss
      summary: Supprime un boss
      parameters:
        - name: nom
          in: path
          description: Nom du boss
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Boss supprimé
        "404":
          description: Boss non trouvé

  /jeu:
    get:
      tags:
        - Jeu
      summary: Commence une nouvelle partie
      responses:
        "200":
          description: Informations de la partie
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Partie"

  /jeu/guess:
    post:
      tags:
        - Jeu
      summary: Soumet une proposition
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                proposition:
                  type: string
                  description: Nom du boss proposé
              required:
                - proposition
      responses:
        "200":
          description: Résultat de la proposition
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ResultatProposition"
        "400":
          description: Proposition invalide

  /souls:
    get:
      tags:
        - Souls
      summary: Liste tous les Souls
      parameters:
        - $ref: "#/components/parameters/pageParam"
        - $ref: "#/components/parameters/limitParam"
      responses:
        "200":
          description: Liste des Souls
          content:
            application/json:
              schema:
                type: object
                properties:
                  souls:
                    type: array
                    items:
                      $ref: "#/components/schemas/Souls"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
    post:
      tags:
        - Souls
      summary: Ajoute un nouveau Souls
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Souls"
      responses:
        "201":
          description: Souls créé avec succès

  /souls/{id}:
    get:
      tags:
        - Souls
      summary: Détails d'un Souls spécifique
      parameters:
        - name: id
          in: path
          description: ID du Souls
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Informations détaillées du jeu
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Souls"
        "404":
          description: Jeu non trouvé
    put:
      tags:
        - Souls
      summary: Met à jour un Souls
      parameters:
        - name: id
          in: path
          description: ID du Souls
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Souls"
      responses:
        "200":
          description: Souls mis à jour
        "404":
          description: Souls non trouvé
    delete:
      tags:
        - Souls
      summary: Supprime un Souls
      parameters:
        - name: id
          in: path
          description: ID du Souls
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Souls supprimé
        "404":
          description: Souls non trouvé

  /joueurs:
    get:
      tags:
        - Joueurs
      summary: Liste tous les joueurs
      parameters:
        - $ref: "#/components/parameters/pageParam"
        - $ref: "#/components/parameters/limitParam"
      responses:
        "200":
          description: Liste des joueurs
          content:
            application/json:
              schema:
                type: object
                properties:
                  joueurs:
                    type: array
                    items:
                      $ref: "#/components/schemas/Joueur"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
    post:
      tags:
        - Joueurs
      summary: Crée un nouveau joueur
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Joueur"
      responses:
        "201":
          description: Joueur créé avec succès

  /joueurs/{id}:
    get:
      tags:
        - Joueurs
      summary: Détails d'un joueur spécifique
      parameters:
        - name: id
          in: path
          description: ID du joueur
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Informations détaillées du joueur
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Joueur"
        "404":
          description: Joueur non trouvé
    put:
      tags:
        - Joueurs
      summary: Met à jour un joueur
      parameters:
        - name: id
          in: path
          description: ID du joueur
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Joueur"
      responses:
        "200":
          description: Joueur mis à jour
        "404":
          description: Joueur non trouvé
    delete:
      tags:
        - Joueurs
      summary: Supprime un joueur
      parameters:
        - name: id
          in: path
          description: ID du joueur
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Joueur supprimé
        "404":
          description: Joueur non trouvé

  /parties:
    get:
      tags:
        - Parties
      summary: Liste toutes les parties
      parameters:
        - $ref: "#/components/parameters/pageParam"
        - $ref: "#/components/parameters/limitParam"
        - name: joueurId
          in: query
          description: Filtrer par joueur
          required: false
          schema:
            type: string
        - name: sort
          in: query
          description: Ordre de tri par date (desc = plus récent d'abord, asc = plus ancien d'abord)
          required: false
          schema:
            type: string
            enum: [asc, desc]
            default: desc
      responses:
        "200":
          description: Liste des parties
          content:
            application/json:
              schema:
                type: object
                properties:
                  parties:
                    type: array
                    items:
                      $ref: "#/components/schemas/Partie"
                  pagination:
                    $ref: "#/components/schemas/Pagination"
    post:
      tags:
        - Parties
      summary: Crée une nouvelle partie
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Partie"
      responses:
        "201":
          description: Partie créée avec succès

  /parties/{id}:
    get:
      tags:
        - Parties
      summary: Détails d'une partie spécifique
      parameters:
        - name: id
          in: path
          description: ID de la partie
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Informations détaillées de la partie
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Partie"
        "404":
          description: Partie non trouvée
    put:
      tags:
        - Parties
      summary: Met à jour une partie
      parameters:
        - name: id
          in: path
          description: ID de la partie
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Partie"
      responses:
        "200":
          description: Partie mise à jour
        "404":
          description: Partie non trouvée
    delete:
      tags:
        - Parties
      summary: Supprime une partie
      parameters:
        - name: id
          in: path
          description: ID de la partie
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Partie supprimée
        "404":
          description: Partie non trouvée

  /stats:
    get:
      tags:
        - Statistiques
      summary: Statistiques globales du jeu
      responses:
        "200":
          description: Statistiques du jeu
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Statistiques"

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: "Token JWT obtenu lors de la connexion ou l'inscription. Format: Authorization: Bearer <token>"

  schemas:
    ApiInfo:
      type: object
      properties:
        nom:
          type: string
          example: "Soulsdle API"
        description:
          type: string
          example: "API pour le jeu de devinettes Soulsdle"
        version:
          type: string
          example: "1.0.0"
        totalBoss:
          type: integer
          example: 150

    Boss:
      type: object
      properties:
        nom:
          type: string
          description: Nom du boss (identifiant unique)
          example: "Père Gascoigne"
        jeu:
          type: string
          enum: [Bloodborne, Sekiro, "Dark Souls III", "Dark Souls"]
          example: "Bloodborne"
        genre:
          type: string
          enum: [Homme, Femme, Inconnu]
          example: "Homme"
        espece:
          type: array
          items:
            type: string
          example: ["Humain", "Bête"]
        phases:
          type: integer
          minimum: 1
          maximum: 3
          example: 2
        nombre:
          type: integer
          description: Nombre d'entités dans le combat
          example: 1
        cutscene:
          type: string
          enum: [Oui, Non]
          example: "Oui"
        optionnel:
          type: string
          enum: [Optionnel, Obligatoire]
          example: "Obligatoire"
        dlc:
          type: string
          enum: [DLC, Base]
          example: "Base"
      required:
        - nom
        - jeu
        - genre
        - espece
        - phases
        - nombre
        - cutscene
        - optionnel
        - dlc

    Partie:
      type: object
      properties:
        id:
          type: string
          description: Identifiant unique de la partie
          example: "partie-001"
        dateDebut:
          type: string
          format: date-time
          description: Date et heure de début de la partie
          example: "2024-01-15T10:30:00Z"
        dateFin:
          type: string
          format: date-time
          description: Date et heure de fin de la partie
          example: "2024-01-15T10:45:00Z"
        bossSecret:
          type: string
          description: Nom du boss à deviner
          example: "Père Gascoigne"
        tentatives:
          type: integer
          description: Nombre de tentatives utilisées
          example: 4
        joueurId:
          type: string
          description: ID du joueur
          example: "joueur-001"
      required:
        - id
        - dateDebut
        - bossSecret
        - joueurId

    ResultatProposition:
      type: object
      properties:
        proposition:
          type: string
          description: Nom du boss proposé
        correct:
          type: boolean
          description: True si c'est la bonne réponse
        indices:
          type: object
          properties:
            jeu:
              type: string
              enum: [correct, incorrect]
            genre:
              type: string
              enum: [correct, incorrect]
            espece:
              type: string
              enum: [correct, partial, incorrect]
            phases:
              type: string
              enum: [correct, incorrect]
            nombre:
              type: string
              enum: [correct, incorrect]
            cutscene:
              type: string
              enum: [correct, incorrect]
            optionnel:
              type: string
              enum: [correct, incorrect]
            dlc:
              type: string
              enum: [correct, incorrect]

    Statistiques:
      type: object
      description: Statistiques globales du jeu (calculées et mises en cache)
      properties:
        id:
          type: string
          description: Identifiant des statistiques (généralement "global")
          example: "global"
        totalParties:
          type: integer
          description: Nombre total de parties jouées
          example: 150
        totalJoueurs:
          type: integer
          description: Nombre total de joueurs inscrits
          example: 25
        bossLesPlusDevines:
          type: array
          description: Liste des boss les plus souvent trouvés
          items:
            type: object
            properties:
              nom:
                type: string
                example: "Père Gascoigne"
              fois:
                type: integer
                description: Nombre de fois que ce boss a été trouvé
                example: 42
        bossLesMoinsTrouves:
          type: array
          description: Liste des boss les moins souvent trouvés
          items:
            type: object
            properties:
              nom:
                type: string
                example: "Orphelin de Kos"
              tauxEchec:
                type: number
                format: float
                description: Taux d'échec (entre 0 et 1)
                example: 0.85
        moyenneEssais:
          type: number
          format: float
          description: Moyenne des tentatives par partie
          example: 4.2
        derniereMaj:
          type: string
          format: date-time
          description: Dernière mise à jour des statistiques
          example: "2024-01-15T12:00:00Z"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required:
        - id
        - totalParties
        - totalJoueurs
        - derniereMaj

    Souls:
      type: object
      properties:
        id:
          type: string
          description: Identifiant unique du jeu
          example: "bloodborne"
        nom:
          type: string
          description: Nom complet du jeu
          example: "Bloodborne"
        annee:
          type: integer
          description: Année de sortie
          example: 2015
        developpeur:
          type: string
          example: "FromSoftware"
        genre:
          type: string
          example: "Action RPG"
        plateforme:
          type: array
          items:
            type: string
          example: ["PS4", "Xbox One", "PC"]
      required:
        - id
        - nom
        - annee
        - developpeur
        - genre
        - plateforme

    Joueur:
      type: object
      properties:
        id:
          type: string
          description: Identifiant unique du joueur (généré automatiquement)
          example: "65a1b2c3d4e5f6g7h8i9j0k1"
        pseudo:
          type: string
          description: Pseudonyme du joueur (unique)
          example: "SoulsHunter"
        email:
          type: string
          format: email
          description: Adresse email du joueur (unique)
          example: "soulshunter@example.com"
        password:
          type: string
          format: password
          description: Mot de passe hashé (non renvoyé dans les réponses)
          minLength: 6
        partiesGagnees:
          type: integer
          description: Nombre de parties gagnées
          default: 0
          example: 12
        streakActuelle:
          type: integer
          description: Série actuelle de victoires consécutives
          default: 0
          example: 5
        meilleureStreak:
          type: integer
          description: Meilleure série de victoires consécutives
          default: 0
          example: 12
        createdAt:
          type: string
          format: date-time
          description: Date de création du compte
        updatedAt:
          type: string
          format: date-time
          description: Date de dernière mise à jour
      required:
        - pseudo
        - email
        - password

    JoueurProfile:
      type: object
      description: Profil public du joueur (sans mot de passe)
      properties:
        id:
          type: string
          example: "65a1b2c3d4e5f6g7h8i9j0k1"
        pseudo:
          type: string
          example: "SoulsHunter"
        email:
          type: string
          format: email
          example: "soulshunter@example.com"
        partiesGagnees:
          type: integer
          example: 12
        streakActuelle:
          type: integer
          example: 5
        meilleureStreak:
          type: integer
          example: 12
      required:
        - id
        - pseudo
        - email
        - partiesGagnees
        - streakActuelle
        - meilleureStreak

    AuthResponse:
      type: object
      properties:
        message:
          type: string
          example: "Connexion réussie"
        token:
          type: string
          description: Token JWT pour l'authentification
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        joueur:
          $ref: "#/components/schemas/JoueurProfile"
      required:
        - message
        - token
        - joueur

    Pagination:
      type: object
      properties:
        page:
          type: integer
        limit:
          type: integer
        total:
          type: integer
        totalPages:
          type: integer

  parameters:
    pageParam:
      name: page
      in: query
      description: Numéro de page (commence à 1)
      required: false
      schema:
        minimum: 1
        type: integer
        format: int32
        default: 1

    limitParam:
      name: limit
      in: query
      description: Nombre maximum d'éléments par page
      required: false
      schema:
        maximum: 100
        minimum: 1
        type: integer
        format: int32
        default: 20
